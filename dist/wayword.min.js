// Licensed on Apache 2.0 with love. Copyright 2022 Chris Larcombe.
function Wayword(t,e){let n;function r(t,e){let n,r=1,o=0;for(n=t.length-1;n>=0;n--)o+=((i=t[n].charCodeAt())>="0".charCodeAt()&&i<="9".charCodeAt()?i-"0".charCodeAt():i-"A".charCodeAt()+10)*r,r*=e;var i;return o}function o(t,e){function n(t){return t>=0&&t<=9?String.fromCharCode(t+48):String.fromCharCode(t-10+65)}let r="";for(;t>0;)r+=n(t%e),t=parseInt(t/e,10);return r.split("").reverse().join("")}function i(t){t=t.split("");let e=[];for(let n=0;n<t.length;n+=2)e.push(`${t[n]+t[n+1]}`);return e.reverse().join("")}function c(t){const e="0000"+BigInt("0x"+t).toString(2),o=h3.h3GetBaseCell(t);let c="";for(let t=19;t<=58;t+=3)c+=r(e.substring(t,t+3),2);return c=i(c),function(t){if(0==t)return n[0];let e=[];for(;t>0;)e.push(n[t%43576]),t=parseInt(t/43576,10);return e.reverse().join("-")}(o*r("6".repeat(14),7)+r(c,7)+o)}function f(t){const e=r("6".repeat(14),7),c=function(t){let e,r=0,o=1;for(e=t.length-1;e>=0;e--)r+=n.indexOf(t[e])*o,o*=43576;return r}(t.split("-"));let f,l=e;for(let t=0;t<122;t++){if(c<=l){f=t;break}l+=e}let u=o(c-f*e-f,7),h="0".repeat(14-u.length)+u;h=i(h);let a="10001110",s=o(f,2);a+="0".repeat(7-s.length)+s;for(let t=0;t<14;t++){let e=o(h[t],2);a+="0".repeat(3-e.length)+e}return a+="111",function(t){return t.match(/.{4}/g).reduce((function(t,e){return t+parseInt(e,2).toString(16)}),"")}(a)}function l(t){let e=t.split("-");for(let t in e)if(-1==n.indexOf(e[t]))throw"invalid digit "+e[t]}function u(){if(!n)throw"digits not loaded yet"}!function(){fetch(t).then((t=>t.text())).then((r=>{if(!r)throw e(),"could not load digits file";(async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")})(r).then((o=>{"3ec021c9ae0680b03ee3bded829c6367c3433b84084ee53404fcdfa2daf6c438"!=o?(console.error("Wayword digits file "+t+" checksum failed."),e(!1,o)):(n=Object.freeze(r.split("\n")),e(!0,o),this.ready=!0)}))}))}(),this.geoToWord=function(t,e){return u(),c(h3.geoToH3(t,e,14))},this.wordToGeo=function(t){return u(),l(t),h3.h3ToGeo(f(t))},this.h3ToWord=function(t){if(u(),14!=h3.h3GetResolution(t)){let e=h3.h3ToGeo(t);console.log(e),t=h3.geoToH3(e[0],e[1],14),console.log(t)}return c(t)},this.wordToH3=function(t){return u(),l(t),f(t)},this.getDigits=function(){return n}}